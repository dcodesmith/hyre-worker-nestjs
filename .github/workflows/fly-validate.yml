name: Validate Fly.io Deployment

on:
  pull_request:
    branches: [ main ]

jobs:
  validate:
    name: Validate deployment config and build
    runs-on: ubuntu-latest
    if: false  # Temporarily disabled - remove this line to re-enable
    steps:
      # Pin to v6.0.1 - check for updates with: gh api repos/actions/checkout/tags --jq '.[0].name'
      - uses: actions/checkout@v6.0.1
      
      # Pin to v3.12.0 - check for updates with: gh api repos/docker/setup-buildx-action/tags --jq '.[0].name'
      - name: Setup Docker Buildx
        uses: docker/setup-buildx-action@v3.12.0
      
      - name: Setup Fly.io CLI
        # Pin to v1.4 - check for updates with: gh api repos/superfly/flyctl-actions/tags --jq '.[0].name'
        uses: superfly/flyctl-actions/setup-flyctl@v1.4
      
      - name: Validate Fly.io config
        run: flyctl config validate
        env:
          FLY_API_TOKEN: ${{ secrets.FLY_API_TOKEN }}
      
      - name: Build Docker image (dry run)
        uses: docker/build-push-action@v5
        with:
          context: .
          push: false
          tags: hyre-worker:test
          cache-from: type=gha
          cache-to: type=gha,mode=max

